var PngValidator=function(r){"use strict";var n,e,t=1229472850,o=1229278788,i=1229209940,f=1347179589,h=1951551059,d=1732332865,a=3,u={0:1,2:3,3:1,4:2,6:4},w=!1,c=!1,l=!1,g=[],p=0,s={};function I(r){var t=n+r;if(t>e.length)throw new Error("Unexpectedly reached end of file. Index: "+n);var o=e.slice(n,t);return n=t,o}function v(r,n){var e=x(r,n);return 2147483648&e?-4294967296^e:e}function x(r,n){return r[n]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3]}s[t]=function(r){var e=r[8],t=r[9],o=r[10],i=r[11],f=r[12];if(8!==e&&4!==e&&2!==e&&1!==e&&16!==e)throw new Error("Unsupported bit depth "+e+". Index: "+n);if(!(t in u))throw new Error("Unsupported color type. Index: "+n);if(0!==o)throw new Error("Unsupported compression method. Index: "+n);if(0!==i)throw new Error("Unsupported filter method. Index: "+n);if(0!==f&&1!==f)throw new Error("Unsupported interlace method. Index: "+n);p=t,w=!0},s[o]=function(r){l=!0},s[i]=function(r){if(p===a&&0===g.length)throw new Error("Expected palette not found. Index: "+n);c=!0},s[f]=function(r){for(var n=Math.floor(r.byteLength/3),e=0;e<n;e++)g.push([r[3*e],r[3*e+1],r[3*e+2],255])},s[h]=function(r){if(p===a){if(0===g.length)throw new Error("Transparency chunk must be after palette. Index: "+n);if(r.byteLength>g.length)throw new Error("More transparent colors than palette size. Index: "+n);for(var e=0;e<r.byteLength;e++)g[e][3]=r[e]}},s[d]=function(r){};var E=[];function y(r){for(var n=-1,e=0;e<r.length;e++)n=E[255&(n^r[e])]^n>>>8;return-1^n}return function(){for(var r=0;r<256;r++){for(var n=r,e=0;e<8;e++)1&n?n=3988292384^n>>>1:n>>>=1;E[r]=n}}(),r.pngValidator=function(r){for(w=!1,c=!1,l=!1,g=[],p=0,n=0,e=r,function(){for(var r=[137,80,78,71,13,10,26,10],e=I(r.length),t=0;t<r.length;t++)if(e[t]!==r[t])throw new Error("Invalid file signature. Index: "+n)}();n<e.byteLength;){var o=x(e,n);if(n+=4,o>e.byteLength-n)throw new Error("Invalid chunk length. Index: "+n);var i=e.slice(n,n+4+o),f=x(e,n);n+=4;for(var h="",d=4;d>0;d--)h+=String.fromCharCode(e[n-d]);var a=Boolean(32&i[0]);if(!w&&f!==t)throw new Error("Expected IHDR on beggining. Index: "+n);var u=I(o),E=s[f];if(null==E){if(!a)throw new Error("Unsupported critical chunk type "+h+". Index: "+n);n+=4}else{E(u);var b=v(e,n);n+=4;var U=y(i);if(U!==b)throw new Error("Crc error - "+b+" - "+U+". Index: "+n)}}if(!w)throw new Error("Parsing ended without finding the IHDR chunk. Index: "+n);if(!c)throw new Error("Parsing ended without finding any IDAT chunk. Index: "+n);if(!l)throw new Error("Parsing ended without finding the IEND chunk. Index: "+n);if(r.byteLength>n)throw new Error("There are bytes left at the end of the file. Index: "+n)},r}({});
